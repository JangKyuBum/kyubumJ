5) 매수 매도 API 익히기
 1) 모의투자 가입하기
대신증권은 이용자들이 실전투자에 앞서 가상으로 투자 및 매매를 해볼 수 있도록 모의투자 시스템을 제공합니다. 알고리즘 트레이딩을 하는 여러분도 모의투자를 통해 안전하게 알고리즘을 검증해 볼 수 있으며, 매수/매도 API도 자유롭게 테스트해볼 수 있습니다.

대신증권의 모의투자를 사용하려면 대신증권 홈페이지를 통해 모의투자에 추가로 가입해야 합니다

 2) 매수/매도하기
대신증권은 이용자들이 실전투자에 앞서 가상으로 투자 및 매매를 해볼 수 있도록 모의투자 시스템을 제공합니다. 알고리즘 트레이딩을 하는 여러분도 모의투자를 통해 안전하게 알고리즘을 검증해 볼 수 있으며, 매수/매도 API도 자유롭게 테스트해볼 수 있습니다.

대신증권의 모의투자를 사용하려면 대신증권 홈페이지를 통해 모의투자에 추가로 가입해야 합니다

CYBOS Plus 탭을 클릭한 후 모의투자용 계정 정보를 입력해 로그인하면 그림 10.27과 같이 모의투자 대회를 선택하는 메뉴가 나타납니다. 앞서 신청한 모의투자 대회가 선택된 것을 확인한 후 [모의투자 접속]을 클릭해 모의투자 시스템으로 접속합니다.

CYBOS Plus 탭을 클릭한 후 모의투자용 계정 정보를 입력해 로그인하면 그림 10.27과 같이 모의투자 대회를 선택하는 메뉴가 나타납니다. 앞서 신청한 모의투자 대회가 선택된 것을 확인한 후 [모의투자 접속]을 클릭해 모의투자 시스템으로 접속합니다.


본격적으로 API를 통해 가상계좌에서 매수를 수행해보겠습니다. 이를 위해 먼저 PyCharm과 같은 에디터를 관리자 모드로 실행해야 합니다. 참고로 매수/매도 API를 이용하려면 주식 시장의 운영 시간에 코드를 실행해야 합니다. 대신증권의 모의투자는 가상이긴 하지만 실제 시장의 운영 시간과 같은 시간에만 운영되기 때문입니다.

CpTrade 모듈의 CpTdUtil과 CpTd0311 클래스를 사용하기 위해 해당 클래스의 인스턴스를 먼저 생성합니다.

import win32com.client

instCpTdUtil = win32com.client.Dispatch("CpTrade.CpTdUtil")
instCpTd0311 = win32com.client.Dispatch("CpTrade.CpTd0311")
instCpTdUtil 객체가 정상적으로 생성되면 해당 객체의 TradeInit 메서드를 호출해 주문을 위한 초기화를 수행합니다.

instCpTdUtil.TradeInit()
TradeInit 메서드가 호출되면 화면에 그림 10.31과 같이 주문확인 설정 대화상자가 나타납니다. 이때 정상적으로 계좌 비밀번호를 입력해야 앞으로 CpTd0311과 같은 주문 객체를 사용할 수 있습니다. 대신증권 모의투자는 계좌비밀번호로 1234를 사용하므로 계좌비밀번호에 1234를 입력한 후 [확인] 버튼을 누릅니다. 이때 [주문내역 확인]의 체크박스는 체크하지 않습니다.

그림 10.30 주문확인 설정 대화상자

TradeInit 메서드를 통해 정상적으로 초기화가 수행되면 CpTd0311 클래스를 이용해 실제 주문을 수행하면 됩니다. 앞서 간단히 설명한 것처럼 CpTd0311 클래스는 Request/Reply 타입이므로 먼저 주문에 관련된 정보를 SetInputValue 메서드로 설정해야 합니다.

표 10.3은 CpTd0311 클래스에서 설정하는 주요 타입 및 입력 데이터의 종류를 나타낸 것입니다. 예를들어, 매수 주문을 넣고 싶다면 SetInputValue(0, 2)와 같은 방식으로 SetInputValue 메서드를 호출하면 됩니다.