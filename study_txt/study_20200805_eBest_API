2) 기초 API 익히기
 (2) 과거 데이터 구하기
  - 알고리즘 트레이딩 시스템을 만들 때 중요한 일 중 하나가 바로 과거 데이터를 확보하는 것이다. 예를 들어, 거래량 분석을 통해 유망한 투자 종목을 뽑는 프로그램을 개발한다면 먼저 각 종목에 대한 일정 기간의 거래량 데이터가 있어야 한다.

이러한 과거 데이터를 구하는 가장 효과적인 방법 중 하나가 바로 증권사에서 제공하는 API를 사용하는 것이다. API를 이용해 주식 종목의 시가, 고가, 저가, 종가, 거래량 등의 데이터를 가져오는 방법을 배운다.

대신증권의 CYBOS Plus 매뉴얼을 참조하면 과거 데이터를 조회하는 데 StockChart 클래스를 사용할 수 있음을 알 수 있다. API 사용법을 알아보기 위해 대신증권 종목에 대한 최근 10일간 종가 데이터를 구하는 코드를 작성한다.

1. CYBOS Plus의 StockChar 클래스를 사용하려면 먼저 StockChart 클래스의 인스턴스를 생성.

StockChart 클래스의 설명을 참조하면 통신 종류가 Request/Reply임을 알 수 있다. 여기서 Request/Reply 방식이란 사용자가 어떤 정보를 얻고자 할 때 얻으려는 정보가 무엇인지를 정확히 알려준 후 요청(Request)하면 CYBOS Plus가 이에 대한 답을 돌려주는(Reply) 방식을 의미한다.

instStockChart.SetInputValue(0, "A003540")
instStockChart.SetInputValue(1, ord('2'))
instStockChart.SetInputValue(4, 10)
instStockChart.SetInputValue(5, 5)
instStockChart.SetInputValue(6, ord('D'))
instStockChart.SetInputValue(9, ord('1'))

코드를 보면 총 6번에 걸쳐 SetInputValue 메서드를 호출한다. SetInputValue 메서드의 첫 번째 인자는 입력 데이터 타입을 의미하고 두 번째 인자는 입력 데이터 값을 의미한다.

예를 들어, SetInputValue(0, "A003540")에서 0은 종목 코드를 의미하고, 'A003540'은 조회하려는 종목의 코드값이다. 앞서 대신증권 종목의 최근 10일 종가를 확인하기로 했는데 대신증권의 종목 코드가 바로 'A003540'이다.

조회할 종목 코드에 대한 정보를 입력했으면 다음으로 조회할 기간을 입력한다. StockChart 클래스는 종목에 대한 과거 데이터를 기간 또는 개수로 조회할 수 있다. 예제에서는 최근 10일간의 종가만 얻기 위해 개수로 지정한다. 기간으로 요청할 때는 '1'을 입력하고, 개수로 요청할 때는 '2'를 입력한다. 다만 파이썬의 문자열을 그대로 입력하는 것이 아니라 ord라는 함수를 통해 문자열 값을 아스키 코드로 변환해야 한다.

세 번째로 입력한 데이터는 요청 개수이다. SetInputValue(4, 10)에서 4는 요청 개수라는 타입을 의미하고 10이 실제로 요청할 데이터의 개수를 의미한다. 10은 최근 거래일로부터 10일 치에 해당하는 데이터를 의미한다.

네 번째로 입력한 데이터는 요청할 데이터의 종류이다. CYBOS Plus 도움말에 있는 StockChart 부분을 참조하면 종가에 해당하는 값이 5임을 알 수 있다.

다섯 번째로 입력한 데이터는 차트의 종류로서 일 단위의 데이터를 가져오기 위해 ord('D')를 입력했다. 여섯 번째로 입력한 데이터는 수정 주가의 반영 여부에 대한 것으로 수정 주가를 의미하는 ord('1')을 입력했다.

이처럼 조회하려는 종목과 조회 조건에 대한 정보를 SetInputValue 메서드를 통해 입력하고 나면 데이터 처리를 요청하면 된다.

Request/Reply 방식에서는 사용자가 BlockRequest 메서드 호출을 통해 서버에 데이터를 요청(request)하면 서버는 해당 데이터를 준비한 후 사용자에게 응답(reply)한다. 서버로부터 데이터를 얻어올 때는 GetHeaderValue와 GetDataValue라는 메서드를 사용한다.
